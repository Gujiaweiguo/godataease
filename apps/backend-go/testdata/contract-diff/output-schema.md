# Contract Diff Output Schema

## Overview

This document describes the JSON output schema for the contract diff report generated by `run_contract_diff.sh`. The report compares API responses between Java and Go backends to ensure behavioral parity.

## Root Object

| Field | Type | Description |
|-------|------|-------------|
| `metadata` | Object | Report generation metadata |
| `summary` | Object | Aggregate statistics |
| `results` | Array | Per-API comparison results |

## Metadata Object

| Field | Type | Description |
|-------|------|-------------|
| `timestamp` | String | ISO 8601 timestamp of report generation |
| `version` | String | Schema version (e.g., "1.0.0") |
| `whitelistPath` | String | Path to the whitelist file used |
| `javaBaseUrl` | String | Java backend base URL |
| `goBaseUrl` | String | Go backend base URL |

## Summary Object

| Field | Type | Description |
|-------|------|-------------|
| `total` | Integer | Total number of APIs tested |
| `passed` | Integer | Number of APIs with matching responses |
| `failed` | Integer | Number of APIs with differences |
| `parity` | Number | Parity percentage (0-100), one decimal |

## Result Object

Each item in the `results` array contains:

### API Identification

| Field | Type | Description |
|-------|------|-------------|
| `path` | String | API endpoint path |
| `method` | String | HTTP method (GET, POST, etc.) |
| `owner` | String | Team or module owner |
| `priority` | String | Priority level (P1, P2, P3) |
| `blockingLevel` | String | Block level (hard, soft, none) |

### Response Objects

Both `javaResponse` and `goResponse` have:

| Field | Type | Description |
|-------|------|-------------|
| `status` | Integer | HTTP status code |
| `code` | String | Business response code |
| `msg` | String | Response message |

### Diff Object

| Field | Type | Description |
|-------|------|-------------|
| `statusDiff` | Boolean | true if HTTP status differs |
| `codeDiff` | Boolean | true if business code differs |
| `msgDiff` | Boolean | true if message differs |
| `payloadDiff` | Boolean | true if response body differs |

### Result Fields

| Field | Type | Description |
|-------|------|-------------|
| `passed` | Boolean | true if all diffs are false |
| `error` | String | Error message if request failed (null if OK) |

## Example Output

```json
{
  "metadata": {
    "timestamp": "2025-01-15T10:30:00Z",
    "version": "1.0.0",
    "whitelistPath": "testdata/contract-diff/whitelist.json",
    "javaBaseUrl": "http://localhost:8081",
    "goBaseUrl": "http://localhost:8082"
  },
  "summary": {
    "total": 10,
    "passed": 8,
    "failed": 2,
    "parity": 80.0
  },
  "results": [
    {
      "path": "/api/datasource/list",
      "method": "GET",
      "owner": "data-team",
      "priority": "P1",
      "blockingLevel": "hard",
      "javaResponse": { "status": 200, "code": "000000", "msg": "success" },
      "goResponse": { "status": 200, "code": "000000", "msg": "success" },
      "diff": { "statusDiff": false, "codeDiff": false, "msgDiff": false, "payloadDiff": false },
      "passed": true,
      "error": null
    },
    {
      "path": "/api/datasource/detail",
      "method": "POST",
      "owner": "data-team",
      "priority": "P1",
      "blockingLevel": "hard",
      "javaResponse": { "status": 200, "code": "000000", "msg": "success" },
      "goResponse": { "status": 200, "code": "999999", "msg": "not found" },
      "diff": { "statusDiff": false, "codeDiff": true, "msgDiff": true, "payloadDiff": false },
      "passed": false,
      "error": null
    }
  ]
}
```
